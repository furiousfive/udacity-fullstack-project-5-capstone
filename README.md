# casting-agency

This project my capstone project for Udacity's Fullstack Nanodegree program.
It models a company that is responsible for creating movies and managing and 
assigning actors to those movies. Authorized users can interact with the API to 
view, add, update, and delete movies and actors details.

## Technologies

- [Python3](https://www.python.org/download/releases/3.0/)
- [Flask](https://palletsprojects.com/p/flask/)
- [Postgres](https://www.postgresql.org/)
- [SQLAlchemy](https://www.sqlalchemy.org/)
- [Flask-SQLAlchemy](https://flask-sqlalchemy.palletsprojects.com/en/2.x/)
- [psycopg2](http://initd.org/psycopg/)
- [Flask-Migrate](https://flask-migrate.readthedocs.io/en/latest/#)
- [alembic](https://alembic.sqlalchemy.org/en/latest/)
- [Flask-Marshmallow](https://flask-marshmallow.readthedocs.io/en/latest/)
- [pytest](https://docs.pytest.org/en/stable/)
- [Flask-RESTX](https://flask-restx.readthedocs.io/en/latest/)


## Installation

```
git clone https://github.com/furiousfive/udacity-fullstack-project-5-capstone.git
python -m venv venv
source venv/Scripts/activate
pip install -r requirements.txt
```

## Usage

Run the command below to start the app.

```
export FLASK_APP=app
export FLASK_DEBUG=False
python manage.py run
```

## Unit tests

Need to setup environment variables that were specific during extra info.
These unit test using a machine to machine auth with all privileges to run
unit tests.

```
pytest -v
```

## Intergration tests

Please run using the following Postman Collection
udacity-fsnd-capstone-herkou.postman_collection.json

## Running migrations

Use the following commands to run database migrations to add tables or columns.

```
flask db init
flask db migrate
flask db upgrade
```

In order to drop a table or column.

```
...
flask db downgrade
```

## Authentication

The API has three registered users:

1. Assistant

```
email: assistant@jscasting.com
password: assistant@jscasting.com1
```

2. Director

```
email: director@jscasting.com
password: director@jscasting.com1
```

3. Producer

```
email: producer@jscasting.com
password: producer@jscasting.com1
```


## API

In order to use the API users need to be authenticated. Jwt tokens can be generated by logging in with the provided credentials on the hosted site.

[Login](https://casting-agency-js.herokuapp.com/index.html)

If you do logout you will need to update access tokens in Postman collection 
by login with users above. 

### Swagger
https://casting-agency-js.herokuapp.com/docs

### Endpoints

#### GET /movies

- General:

  - Returns all the movies.
  - Roles authorized : Casting Assistant,Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/movies`

```json
{
  "movies": [
    {
      "title": "Avengers: Endgame",
      "id": 1,
      "release_date": "2019-04-26"
    },
    {
      "title": "Iron Man",
      "id": 2,
      "release_date": "2008-05-02"
    }
  ],
  "success": true
}
```

#### GET /movies/\<int:id\>

- General:

  - Route for getting a specific movie.
  - Roles authorized : Casting Assistant,Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/movies/1`

```json
{
  "movie": {
      "title": "Avengers: Endgame",
      "id": 1,
      "release_date": "2019-04-26"
  },
  "success": true
}
```

#### POST /movies

- General:

  - Creates a new movie based on a payload.
  - Roles authorized : Executive Producer.

- Sample: `curl http://127.0.0.1:5000/movies -X POST -H "Content-Type: application/json" -d '{ "title": "Natasha romanov", "release_date": "2020-05-06" }'`

```json
{
    "success": true,
    "message": "Iron Man 3 was added!",
    "movie": {
        "title": "Iron Man 3",
        "release_date": "2013-05-03"
    }
}
```

#### PATCH /movies/\<int:id\>

- General:

  - Patches a movie based on a payload.
  - Roles authorized : Casting Director, Executive Producer.

- Sample: `curl http://127.0.0.1:5000/movies/3 -X POST -H "Content-Type: application/json" -d '{ "title": "Natasha romanov patched", "release_date": "2020-05-06" }'`

```json
{
    "success": true,
    "message": "3 was updated!",
    "movie": {
        "id": 3,
        "title": "Iron Man 2",
        "release_date": "2010-05-07"
    }
}
```

#### DELETE /movies/<int:id\>

- General:

  - Deletes a movies by id form the url parameter.
  - Roles authorized : Executive Producer.

- Sample: `curl http://127.0.0.1:5000/movies/3 -X DELETE`

```json
{
    "message": "Movie id 3, Iron Man 2 was deleted!",
    "success": true
}
```

#### GET /actors

- General:

  - Returns all the actors.
  - Roles authorized : Casting Assistant,Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors`

```json
{
  "success": true,
  "actors": [
    {
      "name": "Robert Downey Jr.",
      "id": 1,
      "age": 55,
      "gender": "M"
    },
    {
      "name": "Scarlett Johansson",
      "id": 2,
      "age": 39,
      "gender": "M"
    },
    {
      "name": "Brie Larson",
      "id": 3,
      "age": 30,
      "gender": "F"
    },
    {
      "name": "Chris Hemsworth",
      "id": 4,
      "age": 37,
      "gender": "M"
    }
  ]
}
```

#### GET /actors/\<int:id\>

- General:

  - Route for getting a specific actor.
  - Roles authorized : Casting Assistant,Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors/1`

```json
{
    "success": true,
    "actor": {
        "name": "Robert Downey Jr.",
        "age": 55,
        "id": 1,
        "gender": "M"
    }
}
```

#### POST /actors

- General:

  - Creates a new actor based on a payload.
  - Roles authorized : Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors -X POST -H "Content-Type: application/json" -d '{ "name": "Mary", "age": 22, "gender": "female" }'`

```json
{
  "actor": {
      "name": "Robert Downey Jr.",
      "id": 1,
      "age": 55,
      "gender": "M"
  },
  "success": true
}
```

#### PATCH /actors/\<int:id\>

- General:

  - Patches an actor based on a payload.
  - Roles authorized : Casting Director, Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors/5 -X POST -H "Content-Type: application/json" -d '{ "name": "John", "age": 22, "gender": "female" }'`

```json
{
    "success": true,
    "message": "5 was updated!",
    "actor": {
        "id": 5,
        "name": "Chadwick Boseman",
        "age": 42,
        "gender": "M"
    }
}
```

#### DELETE /actors/<int:id\>

- General:

  - Deletes an actor by id form the url parameter.
  - Roles authorized : Casting Director,Executive Producer.

- Sample: `curl http://127.0.0.1:5000/actors/5 -X DELETE`

```json
{
  "message": "Actor id 5, Chadwick Boseman was deleted!",
  "success": true
}
```
